# 新舊規則比較分析

## 一、核心原則差異

### 現有系統
- 多層規則優先級（規則0-3）
- 場次相同時會忽略等待輪次，改用純等級配對
- 等級差異±1.5是其中一個考量，但可被其他規則覆蓋

### 新規則
- **等級差異±1.5是絕對規則**（最高優先）
- 只有在無法滿足等級規則時才放寬（需手動確認）
- 強調隨機性而非固定優先序

## 二、情況一比較（準備區1-4人）

| 準備區人數 | 現有系統 | 新規則 | 主要差異 |
|------------|----------|---------|----------|
| **1人** | 準備區1人 + 剛下場3人 | 準備區1人 + 剛下場隨機2人 | 新規則：剛下場只取2人（非3人） |
| **2人** | 準備區2人 + 剛下場2人 | 準備區2人 + 剛下場隨機2人 | 相同 |
| **3人** | 準備區**前2人** + 剛下場2人 | 等待輪次最高2人或隨機2人 + 剛下場隨機2人 | 新規則：考慮等待輪次或隨機 |
| **4人** | 準備區前3人(按場次) + 剛下場1人 | 等待輪次最高3人或隨機3人 + 剛下場隨機1人 | 新規則：不再按場次，改為等待輪次或隨機 |

### 關鍵差異：
1. **新規則強調隨機性**：不再是固定取"前N人"
2. **準備區1人的處理不同**：新規則只從剛下場取2人（總共3人），現有系統取3人（總共4人）

## 三、情況二比較（準備區5人以上）

| 準備區人數 | 現有系統 | 新規則 | 主要差異 |
|------------|----------|---------|----------|
| **5人** | 準備區前3人 + 剛下場1人 | 等待輪次最高3人或隨機3人 + 剛下場隨機1人 | 新規則：考慮等待輪次或隨機 |
| **6-7人** | 準備區4人(複雜優先級)，剛下場全下 | 等待2輪以上隨機取2 + 補滿4人，剛下場全下 | **完全不同的邏輯** |
| **8+人** | 等待最高2人 + 場次最低2人 | （新規則未定義） | 需要確認 |

### 6人時的重大差異：
- **現有系統**：
  - 優先選等待3輪的
  - 次選等待2輪的
  - 再選等待1輪以下的
  - 按場次排序

- **新規則**：
  - 等待2輪(含)以上的人隨機取2
  - 剩下的人隨機補滿4人
  - 更簡單直接的邏輯

## 四、等待輪次處理差異

### 現有系統
- 複雜的優先級系統
- 等待超過3輪會強制處理
- 場次相同時會忽略等待輪次

### 新規則  
- 簡化的處理方式
- 等待輪次相同時用隨機
- 6人時特別處理等待2輪以上

## 五、等級配對差異

### 現有系統
- 三種配對函數：
  - `findOptimalCombination`（考慮等待輪次）
  - `findOptimalCombinationLevelOnly`（忽略等待輪次）
  - `findOptimalCombinationRelaxed`（放寬標準）

### 新規則
- 統一的等級配對原則
- ±1.5是絕對規則
- 無法滿足時需手動確認放寬

## 六、主要改進點

### 新規則的優勢：
1. **更多隨機性**：減少固定模式，降低重複配對
2. **簡化邏輯**：去除複雜的規則優先級
3. **絕對等級規則**：確保比賽品質
4. **明確的放寬機制**：需要手動確認

### 可能的問題：
1. **準備區1人時只上場3人**：是否為筆誤？（應該是4人）
2. **8人以上未定義**：需要補充規則
3. **場次完全不考慮**：可能導致場次差異過大

## 七、實施建議

1. **確認準備區1人的規則**：是否真的只上場3人？
2. **定義8人以上的規則**：延續6人的邏輯？
3. **考慮加入場次平衡**：作為次要考量
4. **實作歷史檢查**：避免重複配對