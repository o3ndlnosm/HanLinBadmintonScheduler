# CLAUDE.md

此檔案為 Claude Code (claude.ai/code) 在處理此儲存庫程式碼時提供指引。

## 專案概述

這是一個羽球場地排場系統（翰林羽球排場系統），用於管理多個場地的選手配對。這是一個使用原生 JavaScript、HTML 和 CSS 建立的單頁應用程式，完全在瀏覽器中運行，無需後端伺服器。

## 系統架構

- **純前端應用程式**：無後端伺服器或資料庫
- **單一 HTML 頁面**：`index.html` 載入所有功能
- **主要 JavaScript 檔案**：`js/script.js` 包含所有遊戲邏輯（2000+ 行）
- **樣式設計**：`css/style.css` 使用現代 CSS 變數和響應式設計
- **外部相依套件**：
  - Font Awesome 圖示（CDN）
  - Google Sheets API 用於載入選手資料

## 主要功能

1. **選手管理**：新增選手與技能等級，追蹤比賽場次
2. **場地排程**：自動為 3 個場地同時進行配對
3. **輪替系統**：複雜演算法平衡遊戲時間並避免固定模式
4. **語音播報**：文字轉語音播報場地分配
5. **Google Sheets 整合**：從 Google Sheets 匯入選手名單
6. **動態配額制**：8 名選手情境的特殊模式

## 常用開發指令

由於這是靜態網站，開發方式很簡單：

```bash
# 使用 VS Code Live Server 擴充功能啟動開發伺服器
# （連接埠設定為 5501，在 .vscode/settings.json 中）

# 或使用任何靜態檔案伺服器：
python -m http.server 8000
# 或
npx http-server
```

## 關鍵程式碼區段

### 全域狀態管理 (script.js:1-22)
- `players`：所有註冊選手
- `readyPlayers`：等待比賽的選手
- `restingPlayers`：休息中的選手
- `courts`：各場地目前的比賽
- `historyMatches`：比賽歷史
- 輪替追蹤變數

### 核心演算法

1. **比賽生成** (`generateMatches`, `generateMatchForCourtImmediate`)：建立平衡比賽並避免重複配對的複雜邏輯

2. **等待輪次系統**：選手追蹤等待了多少輪，優先安排等待較久的選手

3. **交叉選擇邏輯** (第 1354-1517 行)：當選手池較小時，用於打破固定輪替模式的特殊演算法

4. **動態配額系統** (第 1284-1341 行)：當恰好有 8 名選手時，交替使用不同的選手選擇比例

### 語音系統 (第 48-288 行)
- 支援行動裝置，具有保持活躍機制
- 順序播報的隊列系統
- 可設定語音選擇

### Google Sheets 整合 (第 1907-1998 行)
- API 金鑰和試算表 ID 為硬編碼
- 依出席狀態篩選選手
- 直接匯入，無模態對話框

## 重要注意事項

1. **無建置流程**：直接編輯檔案，無需編譯
2. **瀏覽器儲存**：頁面重新整理時所有資料會遺失（刻意設計）
3. **中文介面**：所有使用者介面文字均為繁體中文
4. **行動裝置優化**：響應式設計配合視窗設定
5. **語音相容性**：針對 iOS/Android 特性進行廣泛處理

## 常見任務

- **新增功能**：直接編輯 `js/script.js`
- **更新樣式**：使用現有 CSS 變數修改 `css/style.css`
- **測試語音**：使用介面中的「測試語音」按鈕
- **除錯選手輪替**：檢查控制台日誌中的詳細輪替資訊
- **修改 Google Sheets 整合**：更新 script.js 第 1908-1911 行的 API 金鑰和試算表 ID

## 測試方法

由於沒有測試框架：
1. 使用瀏覽器控制台進行除錯
2. 在瀏覽器中手動測試功能
3. 檢查控制台日誌 - 內建廣泛的除錯輸出
4. 在行動裝置上測試語音功能